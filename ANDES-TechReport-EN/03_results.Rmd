# Results

## Technical Implementation of Design Goals

The architecture of \gls{andes} differs significantly from that of its predecessor. The basic system architecture of \gls{andes} is depicted in Figure \@ref(fig:arch). The application and its associated services are centralised on one or several servers and include: 1) a web-service for handling HTTP requests and responses; 2) a database service for storing data associated with the application; 3) a file-sharing service for handling the storage of backups and related files; 4) a printing service used for printing out specimen labels; and 5) a message-brokering service for handling asynchronous tasks. Client devices, such as data-entry workstations, no longer require the installation of anything more than a modern web browser; i.e., one that is capable of supporting HTML5 and ECMAScript (Javascript) 2016. Accordingly, this increases the range of devices and operating systems that may be used for accessing the application. For instance, the switch to using \gls{andes} has allowed the integration of mobile phones, tablets and linux workstations into the data entry workflow. Finally, the new configuration means multiple stations can simultaneously receive and enter data into the same \gls{andes} instance.

### Flexibility, Scalability and Reliability

The [Django Web Framework](https://www.djangoproject.com/) was selected for the backend of this application due to its modularized nature; virtually all aspects of the programming framework can be decoupled. Furthermore, the Django framework is written in pure Python language; an open-source, generalized object-orientated programming language that is popular for use in data-heavy applications. In addition to standard django templates, used to render HTML webpages to end-users, the web framework also contains an elaborate \gls{REST-API} component. Django uses an \gls{ORM} to handle the data layer, and includes \gls{api}s for a variety of modern relational database management systems (i.e., PostgreSQL, MariaDB, MySQL, Oracle, SQLite, etc.). Several of the application's frontend templates contain reactive components implemented in \gls{vuejs}.

While web applications are most often used over a network, the Django library comes with a development web-server that permits users to serve and use the application locally. In this scenario, a single computer acts simultaneously as server and client. While there are important limitations to the use of the Django development web-server in a full-scale production environment, this configuration is adequate for stand-alone use-cases.

The architecture used by \gls{andes} creates networking requirements that were not previously present in the \gls{ese} and \gls{mrr}. The server and the client devices must be connected to the same network. The network does not need to have access to the wide area network (i.e., internet) connection. As long as they are connected to the same \gls{lan}, they can be configured for work together. This suits the networking environment on board remote vessels that can have sporadic connection failures with the wide area network.

The \gls{andes} application provides access to its various components based on an internal system of authentication and authorization. The credentials of a given user will affect what action they are able to do. For example, while the chief scientist are able to modify sampling requirements for the mission, other users are not.

### Version Control / Source Control

It was decided to use [Git](https://git-scm.com/) as the \gls{vcs} for this project due to the fact that it is both widespread in use and open-sourced. The remote repository for this project is currently hosted as a private project on the [Gulf Science organizational GitHub account](https://github.com/dfo-gulf-science). The project is additionally making use of GitHub infrastructure including, pull requests, issue management (e.g., bugs, feature requests and general enhancement requests), security alerts and version releases. The \gls{andes} documentation is also being served using GitHub Pages and can be access [here](https://dfo-gulf-science.github.io/andes/)

### Unit testing

For \gls{andes} development, we use a mixture of test-driven development for critical components of the application, and are also continually adding unit tests for more user-specific components. Using the built-in Python / Django testing framework, this strikes a middle ground between the two approaches described in the above section. While the goal is not to implement test-driven development for the application, the use of unit tests is highly encouraged, especially to back up the core functionality of the application.

### Backup Strategy

The \gls{andes} application has the capability to perform manual and automatic backups. These backups consist of two parts: a gls\{json} export of the entire database and the recording of the current version of the application (i.e., the git hash). The structure of the application models will change over time and thus, so will the structure of the data. Accordingly, in order to re-instantiate a particular data snapshot, it is critical to know the precise version from which it was exported. This combination of data export and git version number, gives users the perpetual ability to recreate the exact application environment from the time of the snapshot; no matter how much the application has change in the interim. In the application, backups are automatically created upon closing sets. However, users also have the ability to manually trigger a backup at anytime.

### Customizable protocols

************* WORK NEEDED
The flexibility of project leads to design, modify and report on their sampling protocol without depending on developers is very important. The application should allow users to provide a variety of detailed information based on their particular sampling protocols, without the need to change the application source code. Similarly, different protocols utilize different code conventions for the identification of biological catches. The application should offer the flexibility of users to utilize their preferred system of catch codes.


### Quality Control

************* WORK NEEDED
The implementation of quality control checks in a data entry application is of paramount importance. At a minimum, the following quality control checks should be leveraged:

| Scope       | Description of Quality Control Item                                                                                                             |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| Set         | Ensure all the required fields on a given set card have been filled in.                                                                         |
| Set         | Ensure the start and end coordinates fall within the expected sampling stratum (if applicable).                                                 |
| Catch       | Ensure catches have a minimum level of data entry associated with them (e.g., should at least contain a basket entry)                           |
| Specimen    | For a given catch, ensure that length measurements do not exceed a maximum value.                                                               |
| Specimen    | For a given catch, ensure the length-to-weight ratio of a specimen falls within an expected range.                                              |
| Observation | The value of a given observation should never be null.                                                                                          |
| Observation | The value of a given observation should respect the data type (integer, float, string) of its observation type.                                 |
| Observation | Ensure that if an observation type (e.g., sex) has a set of defined categories (e.g., male, female) that any entered values are within this set |


### User Interface

The frontend of the application is built in \gls{html5}, \gls{javascript} and \gls{CSS}. Most users will be familiar with the flow and functionality of a web browser and will be comfortable navigating and entering data into a website. Facilitated by the Django model and form classes, all controls (i.e., fields) on the website contain verbose descriptions and help text. The [Bootstap v5.0](https://getbootstrap.com/docs/5.0/getting-started/introduction/) \gls{CSS} and \gls{javascript} libraries were utilized in order to give the application a sleek, modern look and to ensure compatibility with different types of devices (e.g., personal computers, tablets and mobile devices). The Bootstrap library also provides palatable styles for displaying help text in the form of popovers and tooltips.

### Reactivity

The [Django REST framework](https://www.django-rest-framework.org/) was used to construct the WebAPI component of the application. The project takes a hybrid approach, combining the use of standard Django views and \gls{vuejs} frontend applications embedded in the templates. The latter were built to avoid the need for constantly reloading webpages and to optimize the flow of traffic across the network. Reactive javascript frontend applications also provide a better experience from the point of view of an end-user.

### Multilingualism

The Django framework has excellent support for internationalization and localization, including the translation of text and the formatting of dates, times and numbers. It achieves this using a system of "hooks" used by developers to indicate which parts of the code should be localized. See [Django - Internationalization and localization](https://docs.djangoproject.com/en/4.1/topics/i18n/) for more details on this process. In our application, an end-user can toggle between English and French by simply clicking on a button. In this way, each client can view the application in the language of their choice.

### Backup Regime and infrastructure


### Regionalization


## Usage cases

The Andes Django project contains multiple apps that loosely correspond to the different use cases defined in the above section.


### Ecosystem survey data entry

A depiction of the main tables involved in the Ecosystem data entry application, and their relationships are displayed Figure \@ref(fig:ERD_ES). This component of \gls{andes} replicates the capabilities of the \gls{ese} for capturing detailed information on length, weight, ageing material, maturity, etc. about fish and invertebrate specimens. The app running on computers in the wet laboratory of the vessel is used for all entry of data related to measurements and observations of marine organisms (Figure \@ref(fig:andes-wetlab1)). The \gls{Ecosystem Survey} application is the main entrypoint that technicians will use to input survey data.



The Shrimp Ecosystem Survey application resulted from the early adoption of \gls{andes} in the Qu√©bec region. The niche workflow requirements of shrimp survey operations justified the creation of its own \gls{andes} module.

The console to be used by navigation officers is meant to run on a tablet in the bridge of the vessel conducting the survey (Figure \@ref(fig:bridge)). This console contains two separate sections: 1) the Set Card section and 2) the Fishing section. Additionally, a number of events that take place during fishing can be captured in the console. The bridge console also shows the information coming from the trawl mensuration system sensors (Scanmar), which is captured and stored by \gls{andes}.

Part of the task-specific suite of utilities is a forecasting tool that provides real-time prognostics of survey completion targets based on assumed transit speeds and time spent fishing and processing the trawl catches (Figure \@ref(fig:forecast)). This tool provides a useful tool for the chief scientist to evaluate different sampling objectives and survey route. As the conditions change regularly during a survey, this tool links with the set manager to provide an estimate of the amount of time required to complete planned stations. This tool can be used for short-term planning (i.e. a day's worth of sampling) or longer-term planning (i.e. a mission's worth of sampling).

Another task-specific utility is the completion map which shows what strata have been completed based on target and minimum number of sets per stratum. This map provides the chief scientist with a clear visual depiction of what has been accomplished, and what remains to be accomplished, during the survey. The number of sets conducted in each stratum is compared to the minimum and target number of sets per stratum to determine the colour that each stratum will appear in the progress map (Figure \@ref(fig:progress)).

The dashboard utility is meant to obtain a summary of the cruise, it includes the current position and speed of the vessel, the list of the most recent catches in the wet laboratory, as well as running totals of specimens captured (Figure \@ref(fig:dashboard)).

### Oceanographic metadata collection

The simplified \gls{ERD} of the relevant \gls{andes} components is presented in Figure \@ref(fig:ERD).

The Oceanographic module is a stand-alone component of the application that is capable of being deployed independently of the Ecosystem Survey module.

The oceanography data collection is handled by a separate app that is used in the deployment of the rosette and the processing of water samples obtained at different depths  (Figure \@ref(fig:oceanography)).

### Commercial port sampling

The simplified \gls{ERD} of the relevant \gls{andes} components is on Figure \@ref(fig:ERD_ES).

\gls{andes} was adapted to support port sampling activities where technicians obtain length frequency samples from commercial fishing activities. To facilitate deployment, the port sampling app of \gls{andes} is deployed on field tablets with a custom interface that is suitable for use on boats, outdoor and in inclement weather conditions (Figure \@ref(fig:portsampling1)).







<!-- SCRATCH!! -->






### Full list of QC implemented by Andes

| Scope    | Description of Quality Control Item                                                  |
|----------|--------------------------------------------------------------------------------------|
| Set      | Ensure the start and end coordinates are within the sampling stratum (if applicable) |
| Specimen | The calculated specimen weight                                                       |
| Catch    |                                                                                      |

- while fishing bridge console alarm is triggered if leave stratum
